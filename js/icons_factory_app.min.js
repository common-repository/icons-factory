/*  @license Copyright 2017  Artemy Krylov  (email : letter2artemy@gmail.com)  */
function appmap(){var e=ICONSFACTORY.active_modules,t=e.length;if(t>0)for(var i=0;i<t;i++)console.log(e[i],ICONSFACTORY[e[i]]);else console.log("There are no modules")}var ICONSFACTORY=function(){var e="icons_factory",t={slug:e,plugin_url:!1,plugin_dir:!1,plugin_dir_url:!1,action_key:!1,base_palette:!1,WORKROOM:{},STOREROOM:{},UPLOADROOM:{},SUPPORTROOM:{},LIBRARY:{},SVG_DESIGNER:{},SVG_PARSER:{},CLN_MANAGER:{},VC:{},active_modules:[],init:function(e,t){if(e){var i=t?this[t]:this;e=JSON.parse(e);for(var s in e)i[s]=e[s];i.notice&&this.trigger_initial_notice(i.notice)}if(t){var a=this[t],n=a.args;if(void 0!==n){if(!this.check_depends(n))return!1;delete a.args}a.module_name=t,a.only_subscribe?a.subscribe():(a.els&&(a.els=this.cache_dom_els(a.els)),a.init()),this.active_modules.push(t)}},check_depends:function(e){var t=[];for(i=0;i<e.length;i++)void 0===e[i]&&(t.push(i+1),access=!1);return!(t.length>0)||(this.show_fatal_notice("Failed loading modules with indexes: "+t.join(", ")),!1)},on:function(e,t,i,s){if(void 0===i||null===i)return!1;!1===i&&(i=window),s?i.removeEventListener(e,t):i.addEventListener(e,t)},off:function(e,t,i){this.on(e,t,i,!0)},trigger:function(e,t,i){if("function"==typeof Event)s=new Event(e);else{var s;(s=document.createEvent("Event")).initEvent(e,!0,!0)}s.data=t,(i=i||window).dispatchEvent(s)},cancel_bubble:function(e){var t=e||window.event;void 0!==t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault()},ge:function(t){return document.getElementById(e+"_"+t)},ce:function(e,t,i,s){var a=document.createElement(e);if(t)for(var n in t)this.attr(a,n,t[n]);return i&&(a.innerHTML=i),s?a.outerHTML:a},gcl:function(t,i){return(i=i||document).getElementsByClassName(e+"_"+t)},gt:function(e,t,i){var s;return t=void 0!==t?t:0,i=i||document,s=i.getElementsByTagName(e),-1===t?s:s[t]},attr:function(e,t,i){return!(!e||e&&"function"!=typeof e.getAttribute)&&(i?e.setAttribute(t,i):e.getAttribute(t))},add_class:function(t,i,s){if(t&&i){var a=this.attr(t,"class");return i=e+"_"+i,!a||s?(this.attr(t,"class",i),!0):(a+=-1===a.indexOf(i)?(a?" ":"")+i:"",this.attr(t,"class",a),!0)}return!1},remove_class:function(t,i){if(!t)return!1;if(""===i)return this.attr(t,"class"," "),!0;var s=this.attr(t,"class");i=e+"_"+i,-1!==s.indexOf(i)&&(s=s.replace(i,"").trim(),this.attr(t,"class",s))},toggle_class:function(e,t,i){if(!e)return!1;i?this.add_class(e,t,!1):this.remove_class(e,t)},toggle_visibility:function(e,t,i){return!!e&&(e.style.display=i?t:"none",!0)},cache_dom_els:function(e){for(var t={},i=[],s=0;s<e.length;s++){var a=e[s],n=this.ge(a);n||i.push(a),t[a]=n}return i.length,t},clipboard:function(i,s){if(i){if(i.select(),this.supports_storage){if(0===s)localStorage.setItem(e+"_clipboard",i.value);else{var a=localStorage.getItem(e+"_clipboard");a&&(i.value=a)}this.add_class(i,"success_mess"),setTimeout(function(){t.remove_class(i,"success_mess")},300)}try{document.execCommand(0===s?"copy":"paste"),this.add_class(i,"success_mess"),i.blur()}catch(e){this.show_notice("Oops, unable to copy/paste.",1)}}},supports_storage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},send:function(i,s,a){var n=new XMLHttpRequest,r=e+"_json_data="+JSON.stringify(s);i?(n.open("POST",i,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a&&(n.onreadystatechange=function(){4==n.readyState&&"200"==n.status?a(n.responseText):"200"!=n.status&&t.show_notice("Data sending problems.",1)}),n.send(r)):this.show_notice("Data sending problems. Invalid or empty URL of current request: "+i,1)},quick_file_saver:function(e){var t=this.ce("input",{name:"content",type:"hidden",value:JSON.stringify(e)},!1,!0),i=this.ce("input",{name:"data_format",type:"hidden",value:"json"},!1,!0),s=this.ce("input",{name:"content_type",type:"hidden",value:"svg"},!1,!0),a=this.ce("input",{name:"action",type:"hidden",value:"dwnld"},!1,!0),n=this.ce("form",{method:"post",action:this.plugin_url,style:"display:none;"},t+i+s+a);document.body.appendChild(n),n.submit(),setTimeout(function(){document.body.removeChild(n)},300)},delete_files:function(e,i,s){if(e.style.backgroundColor="tomato",s&&!confirm("Do you really want to do this?"))return e.style.backgroundColor="transparent",!1;this.send(this.plugin_url,{action:"delete_files",files:i},function(i){console.log("response",typeof i,i),"0"!==i&&0!==i||e&&e.parentNode.removeChild(e),t.trigger_initial_notice([i,"item","remove","removed"])})},draw_svg_on_canvas:function(e,t,i,s,a,n){var r=new Image,a=a||512,n=n||512,o=!1;return i?(this.attr(e,"width",a),this.attr(e,"height",n),i="data:image/svg+xml;base64,"+btoa(i),r.src=i,this.on("load",function(){t.drawImage(r,0,0);var i,a=e.toDataURL();a?s&&(s[0]&&(a=a.slice(a.indexOf(",")+1)),i=3===s.length?s[2]:a,3===s.length?(s[2].png_data=a,i=s[2]):i=a,s[1](i)):o="Unable to draw Image on the canvas to save it. Reason: maybe browser doesn't support this operation."},r)):o="Empty SVG data.",!1!==o&&this.show_notice(o,1),!o},save_canvas_data_as_png:function(t,i,s){this.attr(t,"download",e+"_"+i+".png"),this.attr(t,"href",s),t.click()},save_file_to_wp_media:function(e,t,i){this.send(this.plugin_url,{action:"save_file_to_wp_media",file_name:e,file_ext:t,file_data:i},!1),this.show_notice("OK! Please, check your Media Library.",0)},highlight_changes:function(e){this.add_class(e,"success_mess"),setTimeout(function(){t.remove_class(e,"success_mess")},300)},explode_num_str_to_arr:function(e){return e.split(",").map(function(e){return parseFloat(e)})},round_num:function(e,t){return t=t>0?Math.pow(10,t):1,(parseFloat(e)*t^0)/t},var_to_str:function(e){return String(e).toLowerCase()},clean_id:function(t){if(t)return t.replace(e+"_","")},clone_obj:function(e,t){if(t)return JSON.parse(JSON.stringify(e));var i={};for(var s in e)i[s]=e[s];return i},parse_shortcode_string:function(t){var i,s=t.indexOf("["),a=t.indexOf("]"),n=t.indexOf(e),r=!1,o={};if(t)if(-1===s||-1===a||-1===n)r=!0;else if(t=t.slice(s+1,a),(i=t.match(/[\w-]+="[^"]*"/g)).length>0)for(var l=0;l<i.length;l++){var _=i[l].split("=");o[_[0].trim()]=_[1].trim().slice(1,-1)}else r=!0;else this.show_notice("Empty value of the target form field.",1);return!1===r?o:(this.show_notice("Sorry but your shortcode syntax is incorrect.",1),!1)},collapse_2Darray_to_clean_object:function(e){for(var t,i=e.length,s="",a={},n=[],r=0;r<i;r++)if(t=e[r][1],-1===n.indexOf(t)){for(var o=0;o<i;o++)e[o][1]===t&&(s+=e[o][0]+";");a[s.slice(0,-1)]=t,s="",n.push(t)}return a},check_allowed_file_type:function(e,t){var i=!0,s=e.length;if(s>0&&t)for(var a=0;a<s;a++){var n=e[a];this.get_normal_file_type(n.type)!==t&&(i=!1)}else i=!1;return i},get_normal_file_type:function(e){return"image/svg+xml"===e?"svg":"application/zip"===e?"zip":"image/png"===e&&"png"},escape_sting:function(e,t){return e?(e=e.replace(/\s+/g," "),t?encodeURIComponent(e.replace(/"/g,"&quot;").replace(/'/g,"&apos;")):e.replace(/\"|\[|\]|\'|\&|\r\n|\n|\r|\t|\.|,|<|>/gm,"").trim()):(console.log("Empty string"),!1)},title_to_string:function(e){if(e){var t=(e=e.replace(/ic_/,"")).toLowerCase().match(/[a-z0-9]+/g);if(t)return t.join("-")}return console.log("Empty string!"),!1},float_num_to_string:function(e,t){t||(t=".");var i=e.toLowerCase().match(/[0-9]+/g);return i?i.length>1?i.map(Number).join(t):i+".0":(console.log("Empty string!"),!1)},check_email:function(e){if(!e)return!1;var t,i=e.split("@");return 2===i.length&&(2===(t=i[1].split(".")).length&&i[0].trim()+"@"+t[0].trim()+"."+t[1].trim())},show_notice:function(i,s){if(this.notice_container||(this.notice_container=this.ge("response")),void 0!==this.notice_container){var a,n=7e3;0===s?a="success":1===s?(a="alert",n=14e3):-1===s&&(a="fatal_error"),this.notice_container.className=e+"_notification "+e+"_active_notification "+e+"_"+a+"_mess",this.notice_container.innerHTML="<div>"+i+"</div>",-1!==s&&setTimeout(function(){t.remove_class(t.notice_container,"active_notification")},n)}else alert(i)},trigger_initial_notice:function(e){if(4===e.length){var t,i,s=e[0],a=e[1],n=e[2],r=e[3];"false"===s||!1===s||void 0===s||"0"===s||0===s?(t="Ok! The "+a+" has been "+r+".",i=0):(t="Oops, unable to "+n+" this "+a+". Reason: "+s+".",i=1),this.show_notice(t,i)}else console.log(e)},show_fatal_notice:function(e){this.show_notice("The plugin was stopped. Reason: "+e+". Please call to Guru: letter2artemy@gmail.com.",-1)},confirm_page_refreshing:function(e){window.onbeforeunload=e?"":function(){return"Are you sure you want to leave?"}}};return t}();ICONSFACTORY.UNIVERSAL_PAGE_CTRLS=function(e){var t=0,i=0,s={init_window:function(){t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},init_smart_layout:function(t,i){var a=function(){};this.smart_layout=e.ge(t),this.smart_layout?(this.smart_layout_ctrl=e.gcl("smart_layout_ctrl",this.smart_layout)[0],this.smart_layout_ctrl?(this.smart_layout_state=0,this.smart_layout_initial_cl=this.smart_layout.className,this.smart_layout_states=i,e.on("click",function(e){s.toggle_smart_layout_state()},this.smart_layout_ctrl)):a()):a()},toggle_smart_layout_state:function(){var t;this.smart_layout_state=this.smart_layout_state===this.smart_layout_states.length-1?0:this.smart_layout_state+1,t=this.smart_layout_states[this.smart_layout_state],this.smart_layout.className=this.smart_layout_initial_cl+(t?" "+e.slug+"_"+t:"")},init_scroller:function(t){var i=e.gcl("scroller")[0];i?(this.scroller_state=!1,e.on("click",function(e){s.scroller_state?(window.scrollTo(0,0),s.scroller_state=!1):(window.scrollTo(0,t),s.scroller_state=!0)},i)):console.log("Some problems with initialization of a page scrolling controller on this page.")},init_fixed_layout:function(a){this.fixed_layout=e.ge("fixed_layout"),this.fixed_layout?(this.fixed_layout_control_point=a||0,this.init_window(),t>600&&i>770&&e.on("scroll",function(){s.fixed_layout_handler()},!1),e.on("resize",function(e){s.init_window()},!1)):console.log("Some problems with initialization of a fixed layout on this page.")},fixed_layout_handler:function(){if(this.fixed_layout){var e=window.pageYOffset||document.documentElement.scrollTop;e>this.fixed_layout_control_point?(this.fixed_layout.style.transform="translateY("+(e-this.fixed_layout_control_point)+"px)",this.state_fixed=!0):!0===this.state_fixed?(this.fixed_layout.style.transform="translateY(0)",this.state_fixed=!1):state_fixed=!1}}};return s}(ICONSFACTORY),ICONSFACTORY.CUSTOM_UI=function(e){var t={},i={transform_center:!0,transform_locked_els:!1,init:function(){},num_ctrls_init:function(s){var a=e.gcl("numctrl_wrap");if(a){for(var n=0;n<a.length;n++){var r=a[n],o=e.attr(r,"data-param"),l=e.attr(r,"data-def_value"),_=r.children[0],c=_.value,d=e.gcl("numctrl_input",r);if(l=l.indexOf(",")>-1?e.explode_num_str_to_arr(l):[parseFloat(l)],c=c?c.indexOf(",")>-1?e.explode_num_str_to_arr(c):[parseFloat(c)]:JSON.parse(JSON.stringify(l)),t[o]={els:{target_field:_},def_value:l,value:c},d)for(var u=0;u<d.length;u++){var h=d[u];min=parseInt(e.attr(h,"data-min")),max=parseInt(e.attr(h,"data-max")),step=parseInt(e.attr(h,"data-step"))||1,t[o].els[u]=[h,[step,min,max]],h.value=c[u],e.on("change",function(e){i.num_ctrls_handler(e,!0)},h)}e.on("click",function(e){i.num_ctrls_handler(e,!1)},r)}this.transform_locked_els=e.ge("numctrl_locked_content"),t.callback=s}},num_ctrls_handler:function(i,s){var a=i||window.event,n=a.target||a.srcElement,r=e.attr(n,"data-param");if(!r)return!1;var o,l=parseInt(e.attr(n,"data-target")),_=!1,c=!1,d=!1,u=t[r].els[l][0],h=t[r].els[l][1][0]*(!0===a.shiftKey?10:1);s?(o=this.check_num_ctrl_value(r,n.value,l),t[r].value[l]=o,u.value=o,d=!0):(d=e.attr(n,"data-act"))&&(o=this.check_num_ctrl_value(r,t[r].value[l]+("-"===d?-h:h),l),t[r].value[l]=o,u.value=o),"image_transform"===r&&d&&this.update_transform_ctrl(l,o),c=t[r].def_value.join(","),(_=t[r].value.join(","))!==c?t[r].els.target_field.value=_:_=!1,!1!==o&&d&&t.callback(r,"image_transform"===r?_:o)},check_num_ctrl_value:function(i,s,a){var n=t[i].els[a][1][1],r=t[i].els[a][1][2],o=t[i].def_value[a];return""===s||void 0===s?o:(s=e.round_num(s,2))>=n&&s<=r?s:s<n?n:s>r?r:o},update_num_ctrl:function(e,i){t[e]&&t[e].els&&(t[e].els[0][0].value=i,t[e].value=[i])},update_transform_ctrl:function(i,s){if(i<0){Array.isArray(s)||(s=e.explode_num_str_to_arr(s));for(var a=0;a<3;a++)t.image_transform.value[a]=s[a],t.image_transform.els[a][0].value=s[a];s+""!=t.image_transform.def_value+""&&(this.transform_center=!1,this.transform_locked_els.className="")}else if(0===i&&this.transform_center)e.round_num((t.image_transform.def_value[0]-s)/2,2);else this.transform_center=!1,this.transform_locked_els.className=""}};return i}(ICONSFACTORY),ICONSFACTORY.LIBRARY=function(e){var t={els:["lib","lib_def_wrapper","lib_external_wrapper","lib_filters","lib_item_ui_toggler","lib_filters_toggler","workroom_layer_1"],state:{filters_visibility:!1,lib_visibility:!0,actual_cln:"default",prev_cln_el:!1,second_ui:!1,rendering:!1},init:function(){this.publish(),this.subscribe(),this.set_private_listeners()},publish:function(){this.els.lib&&e.on("click",function(i){var s,a,n,r=i||window.event,o=r.target||r.srcElement,l=e.attr(o,"data-act"),_=r.shiftKey;if("ignore"!==l){for(;!l&&o!==r.currentTarget;)o=o.parentNode,l=e.attr(o,"data-act");for(;"label"!==o.tagName.toLowerCase()&&o!==r.currentTarget;)o=o.parentNode;n=o,s=e.attr(n,"data-id"),a=e.attr(n,"data-cln-id")||"default","sel"===l&&e.trigger("sel_lib_item",{item_id:s,cln_id:a}),"edit"===l&&t.edit_item(s),"del"===l&&t.del_item(s,n,!_)}},this.els.lib)},subscribe:function(){e.on("render_lib",function(e){var i=e||window.event;t.render_cln(i.data)},!1)},set_private_listeners:function(){this.els.lib&&(this.els.lib_filters&&e.on("click",function(e){t.filters_handler(e)},this.els.lib_filters),this.els.lib_item_ui_toggler&&e.on("click",function(e){t.lib_item_ui_toggler_handler(e,this)},this.els.lib_item_ui_toggler),this.els.lib_filters_toggler&&e.on("click",function(e){t.lib_filters_toggler_handler(e,this)},this.els.lib_filters_toggler))},lib_item_ui_toggler_handler:function(t,i){this.state.second_ui?(i.innerHTML="Show titles",this.state.second_ui=!1,e.remove_class(this.els.lib,"lib_state_second_ui")):(i.innerHTML="Hide titles",this.state.second_ui=!0,e.add_class(this.els.lib,"lib_state_second_ui")),e.cancel_bubble(t)},lib_filters_toggler_handler:function(t,i){this.els.workroom_layer_1.scrollTop=0,this.state.filters_visibility=!this.state.filters_visibility,e.toggle_visibility(this.els.lib_filters,"block",this.state.filters_visibility),i.innerHTML=(this.state.filters_visibility?"Close":"Show")+" filters"},filters_handler:function(t){for(var i=t||window.event,s=i.target||i.srcElement,a=e.attr(s,"data-cln");!a&&s!==i.currentTarget;)s=s.parentNode,a=e.attr(s,"data-cln");a&&(this.state.actual_cln=a,this.state.prev_cln_el&&e.remove_class(this.state.prev_cln_el,"actual_cln"),"default"===a?(this.def_cln_handler(s),this.els.lib_external_wrapper.innerHTML=""):!1===this.state.rendering&&(this.render_cln(a),e.add_class(s,"actual_cln"),this.state.prev_cln_el=s))},def_cln_handler:function(t){if(this.els.prev_filter_el&&e.remove_class(this.els.prev_filter_el,"pressed_btn"),t){var i=e.attr(t,"data-cat");e.add_class(t,"pressed_btn"),e.add_class(this.els.lib_def_wrapper,"lib_state_"+i,!0),this.els.prev_filter_el=t}else e.remove_class(this.els.lib_def_wrapper,"")},render_cln:function(i){if(i){this.state.rendering=!0,this.def_cln_handler();var s=setTimeout(function(){t.els.lib_external_wrapper.innerHTML='<p class="'+e.slug+'_p">LOADING. Please wait...</p>'},300);e.send(e.plugin_url,{action:"get_lib_content",cln_id:i},function(e){t.els.lib_external_wrapper.innerHTML=e,t.state.rendering=!1,t.state.actual_cln=i,clearTimeout(s)})}},edit_item:function(t){t?window.open(e.plugin_url+"_uploadroom&file="+t+"&cln="+this.state.actual_cln,"_blank"):console.log("Empty item ID")},del_item:function(t,i,s){var a="library/"+this.state.actual_cln+"/";files=[a+t+".png",a+t+".php"],e.delete_files(i,files,s)},toggle_lib:function(t){e.toggle_visibility(this.els.lib,"block",t),this.state.lib_visibility=t}};return t}(ICONSFACTORY),ICONSFACTORY.SVG_PARSER=function(e,t){var s={args:arguments,els:["ctrls_container","trash_container","navigator_screen_original","navigator_screen_processed","canvas_processed","cln_selectbox","save_btn","title_input","next_btn","pbar"],files:!1,actual_file:0,is_saved:!1,standard_viewbox:"0 0 512 512",viewbox:!1,original_title:!1,svg_data_model:!1,model_start_offset:0,shapes:!1,shape_ctrls:!1,processed_image:!1,canvas_processed_ctx:!1,prev_shape_index:-1,is_shift:!1,init:function(){console.log(this.svg_data_model);var i=[];t.init_fixed_layout(),this.init_shapes(),this.check_svg_data_model(),this.ui_dep_map?this.init_shape_controllers():i.push('No "ui_dep_map."'),this.els.canvas_processed?this.canvas_processed_ctx=this.els.canvas_processed.getContext("2d"):i.push('No "canvas_processed."'),this.els.pbar&&this.init_pbar(),this.els.navigator_screen_processed?(this.processed_image=this.els.navigator_screen_processed.childNodes[0],e.on("click",function(e){s.restart_animation()},this.els.navigator_screen_processed)):i.push('No "navigator_screen_processed."'),this.els.ctrls_container?(e.on("mouseover",function(t){s.ctrls_handler(t,0),e.cancel_bubble(t)},this.els.ctrls_container),e.on("change",function(t){s.ctrls_handler(t,1),e.cancel_bubble(t)},this.els.ctrls_container),e.on("click",function(e){s.ctrls_handler(e,2)},this.els.ctrls_container),e.on("click",function(e){!1!==s.prev_shape_index&&(s.mute_actual_shape(!0),s.mute_navigator_screen_processed())},document.body),e.on("keydown",function(e){var t=e||window.event;s.is_shift=t.shiftKey},document.body),e.on("keyup",function(e){s.is_shift=!1},document.body)):i.push('No "ctrls_container."'),e.on("click",function(t){s.save_processed_image_step_1(),e.cancel_bubble(t)},this.els.save_btn),this.els.title_input?(e.on("change",function(t){this.value=this.value?s.r_mode||s.edit_def_lib_mode?this.value:e.title_to_string(this.value):"auto-name"},this.els.title_input),this.init_file_title()):i.push('No "title_input."'),this.els.next_btn&&e.on("click",function(){s.get_next_file()},this.els.next_btn),i.length>0&&e.show_fatal_notice(i.join(" ")),this.r_mode||e.confirm_page_refreshing()},check_svg_data_model:function(){void 0!==this.svg_data_model[0].p&&this.model_start_offset++},init_shapes:function(){this.shapes=e.gcl("shape")},init_shape_controllers:function(t){for(var t=this.ui_dep_map,i=e.gcl("ui_row"),s=[],a=0;a<i.length;a++){var n=i[a],r=n.children[1].children[0],o=void 0!==t[a],l={g:o?1:0,row_el:n,label_el:r,field_els:e.gcl("ui",n)};o?(l.childrens=t[a].c,l.g_state=t[a].s):(l.inner_ui=e.gcl("inner_ui",n)[0],l.inner_ui_state=!1),s.push(l)}this.shape_ctrls=s},init_file_title:function(){this.original_title||(this.original_title=this.files[this.actual_file].name),this.els.title_input.value=this.r_mode||this.edit_def_lib_mode?this.original_title:e.title_to_string(this.original_title)},init_pbar:function(){var e=this.els.pbar;this.els.pbar_indicator=e.children[0],this.els.pbar_label=e.children[1],this.els.pbar_label_actual_val=this.els.pbar_label.children[0],this.els.pbar_label_total_val=this.els.pbar_label.children[2]},update_svg_data_model:function(e,t,i){"–"===i?delete this.svg_data_model[t][e]:this.svg_data_model[t][e]=i},ctrls_handler:function(t,i){var s=t||window.event,a=s.target||s.srcElement,n=e.attr(a,"data-index");if(this.is_shift=!0===s.shiftKey,n||"0"==n)if(0===i)this.navigator_screen_processed_handler(n);else if(1===i||2===i&&this.is_shift){var r=e.attr(a,"data-param"),o=a.value;r&&("f"!==r&&"t"!==r&&"m"!==r||(o=parseInt(o)),this.change_actual_file(r,n,o,!1,this.is_shift))}else if(2===i){var l=e.attr(a,"data-role");if("group_expander"===l)this.toggle_group_state(n,a);else if("inner_ui_expander"===l)this.toggle_inner_ui_state(n,a);else if("ui"===l){if("to"===(r=e.attr(a,"data-param"))){(o=e.attr(a,"data-to"))!==this.svg_data_model[n].to&&(this.change_actual_file(r,n,o,!1,!1),this.update_to_ctrl(a))}}}},change_actual_file:function(e,t,i,s,a){if(this.update_shape_in_preview(e,t,i),s&&this.update_ui_field(e,t,i),0===this.svg_data_model[t].g&&a)for(var n=this.shape_ctrls[t].childrens,r=0;r<n.length;r++)this.change_actual_file(e,n[r],i,!0,!0);this.update_svg_data_model(e,t,i)},update_ui_field:function(t,i,s){var a=this.shape_ctrls[i].field_els[e.slug+"_"+t+"_"+i];a&&(a.value=s)},update_to_ctrl:function(t){var i="sm_active",s=e.gcl(i,t.parentNode)[0];e.remove_class(s,i),e.add_class(t,i)},toggle_group_state:function(e,t){if(void 0!==this.shape_ctrls[e]){this.shape_ctrls[e].row_el.children[2];for(var i=this.shape_ctrls[e].childrens,s=this.shape_ctrls[e].g_state,a=0;a<i.length;a++){var n=this.shape_ctrls[i[a]].row_el;void 0!==n&&(n.style.display=0===s?"block":"none",void 0!==this.shape_ctrls[i[a]]&&1===this.shape_ctrls[i[a]].g_state&&this.toggle_group_state(i[a],this.shape_ctrls[i[a]].label_el))}t&&(t.innerHTML=0===s?"Close Group":"Group",this.shape_ctrls[e].g_state=0===s?1:0)}},toggle_inner_ui_state:function(e,t){var i,s=this.shape_ctrls[e];void 0!==s&&(i=t.innerHTML,s.inner_ui.style.display=s.inner_ui_state?"none":"block",t.innerHTML=s.inner_ui_state?i.replace("Close ",""):"Close "+i,s.inner_ui_state=!s.inner_ui_state)},navigator_screen_processed_handler:function(e){if(e!==this.prev_shape_index){var t=this.shapes[e];this.hightlight_navigator_screen_processed(),t&&this.hightlight_actual_shape(t),!1!==this.prev_shape_index&&this.mute_actual_shape(),this.prev_shape_index=e}},update_shape_in_preview:function(t,i,s){var a=this.shapes[i];"f"===t?e.attr(a,"fill",e.base_palette[s]):"ag"===t?e.add_class(a,"–"===s?"shape":"shape "+e.slug+"_ag "+e.slug+"_ag_"+s,!0):"t"===t?a.style.display=-1===s?"none":"block":"to"===t?e.attr(a,"style",this.normalize_transform_origin(s)):"d"===t&&"path"===a.nodeName.toLowerCase()&&e.attr(a,"d",s)},normalize_transform_origin:function(e){if("c"===e)return[50,50];for(result="",str_len=e.length,i=0;i<2;i++)x=i<str_len?e[i]:e[0],result+=(i>0?" ":"")+("c"===x?50:"l"===x||"t"===x?0:100)+"%";return"-webkit-transform-origin: "+result+" !important; transform-origin: "+result+" !important; -ms-transform-origin: "+result+' !important;"'},restart_animation:function(){var t=s.processed_image.childNodes[1].childNodes[0].childNodes[0];e.remove_class(t,"start_anim"),setTimeout(function(){e.add_class(t,"start_anim")},100)},normalize_svg_data_model:function(){var t=this.viewbox!==this.standard_viewbox?[{p:{viewBox:this.viewbox}}]:[];for(var i in this.svg_data_model){-1!==this.svg_data_model[i].t&&(t.push(e.clone_obj(this.svg_data_model[i])),0)}return t},save_processed_image_step_1:function(){this.init_png_image_preview(function(e){s.save_processed_image_step_2(e)})},save_processed_image_step_2:function(t){var i=this.normalize_svg_data_model(),a=this.els.title_input.value,n=this.els.cln_selectbox.value,r="Oops, unable to save the file. Call to Guru, please.";return"0"===n?(e.show_notice("You should select an image collection.",1),!1):a?(e.remove_class(this.els.title_input,"alert_mess"),void(a&&i&&t&&this.viewbox?e.send(e.plugin_url,{action:"save_svg_file",svg_data:i,png_data:t,viewbox:s.viewbox,title:a,cln:n,o_title:s.original_title,resave:!!s.r_mode||s.is_saved},function(t){console.log("SVG saving response",t),1===(t=parseInt(t))?(s.is_saved=!0,e.show_notice("Ok! The image has been saved in the Image library.",0)):-1===t?e.show_notice("An image with this title already exists.",1):e.show_notice(r,1)}):e.show_notice(r,1))):(e.add_class(this.els.title_input,"alert_mess"),!1)},init_png_image_preview:function(t){var i,s,a=this.els.navigator_screen_processed.innerHTML,n=e.attr(this.processed_image,"viewBox");n&&(i=(n=n.split(" "))[2],s=n[3]),e.draw_svg_on_canvas(this.els.canvas_processed,this.canvas_processed_ctx,a,[1,t],i,s)},hightlight_actual_shape:function(t){e.add_class(t,"hl")},mute_actual_shape:function(t){this.shapes[this.prev_shape_index]&&e.remove_class(this.shapes[this.prev_shape_index],"hl"),t&&(this.prev_shape_index=!1)},hightlight_navigator_screen_processed:function(){e.add_class(this.els.navigator_screen_processed,"wireframe")},mute_navigator_screen_processed:function(){e.remove_class(this.els.navigator_screen_processed,"wireframe")},get_next_file:function(){var t,i=this.els.next_btn,a=this.files.length;this.actual_file++,this.actual_file<a&&(this.els.pbar_label_actual_val.innerHTML=this.actual_file+1,this.els.pbar_indicator.style.width=(this.actual_file+1)/a*100+"%",t=this.files[this.actual_file].name,this.original_title=t,this.original_title.value=t,setTimeout(function(){s.re_init()},1e3)),this.actual_file===a-1&&(i.innerHTML="FINISH",e.off("click",s.get_next_file,i),e.on("click",function(){s.finish()},i))},re_init:function(){if(this.files[this.actual_file]){var t,i=this.files[this.actual_file].name,a=e.plugin_dir+"temp/"+i+".svg",n=function(){e.trigger_initial_notice(["SVG parsing problems","file","load","loaded"])};e.send(e.plugin_url,{action:"parse_svg_file",file_path:a,file_name:i},function(e){"0"===e||0===e?n():(t=JSON.parse(e))&&t.ui_view&&t.viewbox&&t.svg_data_model&&t.ui_dep_map?(s.els.ctrls_container.innerHTML=t.ui_view,s.viewbox=t.viewbox,s.svg_data_model=t.svg_data_model,s.ui_dep_map=t.ui_dep_map,s.render_navigator_screen_original(t.svg_original),s.render_navigator_screen_processed(t.svg_processed),s.init_shapes(),s.init_shape_controllers(),s.init_file_title(),s.is_saved=!1,t.trash.length>0&&render_trash_container(t.trash),s.toggle_trash_container(t.trash.length)):n()})}},render_navigator_screen_original:function(e){this.els.navigator_screen_original.innerHTML=e},render_navigator_screen_processed:function(e){this.els.navigator_screen_processed.innerHTML=e,this.processed_image=this.els.navigator_screen_processed.childNodes[0]},render_trash_container:function(e){this.els.trash_container.innerHTML=e.join(", ")},toggle_trash_container:function(t){e.toggle_visibility(this.els.trash_container,"block",t)},finish:function(){window.location=e.plugin_url+"_uploadroom"},get_model_as_json:function(){return JSON.stringify(this.svg_data_model)}};return s}(ICONSFACTORY,ICONSFACTORY.UNIVERSAL_PAGE_CTRLS),ICONSFACTORY.CLN_MANAGER=function(e,t){var i={args:arguments,els:["cln_manager_form","cln_selectbox","cln_logo_img","cln_logo_preview"],cln_data:!1,cln_fields_data:!1,cln_btns_data:!1,cln_logo_img:!1,default_logo:!1,cln_selectbox:!1,cln_btns_els:{},cln_fields_els:{},actual_cln:!1,init:function(){if(!(this.cln_data&&this.cln_fields_data&&this.cln_btns_data))return e.show_fatal_notice("Empty initial data"),!1;this.cache_ui_els(this.cln_fields_data,this.cln_fields_els),this.cache_ui_els(this.cln_btns_data,this.cln_btns_els,!0),this.default_logo=e.attr(this.els.cln_logo_img,"src"),this.cln_fields_data.logo=this.default_logo,this.cln_fields_els.logo=e.ge("cln_logo_input"),this.els.cln_selectbox&&e.on("change",function(t){i.select_cln(this.value),e.cancel_bubble(t)},this.els.cln_selectbox),e.on("change",function(e){i.check_cln_logo_file(this)},this.cln_fields_els.logo),t.els.lib=e.ge("lib"),t.els.lib_external_wrapper=e.ge("lib_external_wrapper")},cache_ui_els:function(t,s,a){for(key in t)s[key]=e.ge(key),a&&s[key]&&e.on("click",function(t){var s=e.attr(this,"data-act");i.cln_handlers_wrapper(s)},s[key])},cln_handlers_wrapper:function(e){e&&(this.cln_fields_els.action.value=e,this.cln_fields_els.cln_id.value=this.actual_cln,this[e](this))},save_cln:function(t){e.cancel_bubble(window.event);t.check_cln_fields_and_get_new_data()?(t.cln_fields_els.as_blank.value=t.actual_cln,t.els.cln_manager_form.submit()):console.log("No access to save this collection")},render_cln:function(i){e.cancel_bubble(window.event),t.toggle_lib(!0),t.render_cln(i.actual_cln)},del_cln:function(t){return e.cancel_bubble(window.event),t.actual_cln?!!confirm('Do you really want to do this? You can cancel this operation to make a reserve copy. Just click on the "Download button" (It is a little button with an arrow). In any case after deleting – all shortcodes and presets which used images from this collection will not be available.')&&void t.els.cln_manager_form.submit():(e.show_notice("Unable to delete this collection."),!1)},dwnld_cln:function(t){e.cancel_bubble(window.event),t.cln_fields_els.content.value=t.actual_cln,t.actual_cln?t.els.cln_manager_form.submit():e.show_notice("Unable to download this collection. Try to reload the page.")},select_cln:function(i){if("0"===i||!1===this.actual_cln){for(key in this.cln_btns_els)this.cln_btns_data[key][1].indexOf("hidden")>-1&&e.toggle_visibility(this.cln_btns_els[key],"inline-block","0"!==i);e.library_visibility&&t.toggle_lib(!1)}if(this.actual_cln="0"!==i&&i,e.attr(this.els.cln_logo_img,"src","0"===i?this.default_logo:this.cln_data[i].logo),"0"!==i)for(key in this.cln_fields_els){var s=this.cln_data[i][key];e.attr(this.cln_fields_els[key],"value",s)}t.toggle_lib()},check_cln_fields_and_get_new_data:function(){var t,i=!0,s={};for(key in this.cln_fields_els){var a,n=this.cln_fields_els[key],r="hidden"===this.cln_fields_data[key][2]||"logo"===key,o="email"===key||"license"===key;if(!n){i=!1;break}if(a=n.value,!r&&!o){if(a){switch(key){case"version":(t=e.float_num_to_string(a))&&(n.value=t);break;case"email":(t=e.check_email(a))&&(n.value=t);break;default:t=a}t?s[key]=t:i=!1}else i=!1,t=a;e.toggle_class(n,"alert_mess",!t)}"logo"===key&&(this.check_cln_logo_file(this.cln_fields_els.logo,"alert_mess")||(i=!1))}return!!i&&(this.cln_fields_els.cln_id.value=this.actual_cln,!0)},check_cln_logo_file:function(t,i){if(1===t.files.length){var s=t.files[0];return"image/png"!==s.type?(e.add_class(this.els.cln_logo_preview,i),!1):(e.remove_class(this.els.cln_logo_preview,i),this.set_cln_logo_temp_src(s),!0)}return!0},set_cln_logo_temp_src:function(e){if(FileReader){var t=new FileReader;t.onload=function(){i.els.cln_logo_img.src=t.result},t.readAsDataURL(e)}}};return i}(ICONSFACTORY,ICONSFACTORY.LIBRARY),ICONSFACTORY.SVG_DESIGNER=function(e,t,s,a){var n={args:arguments,els:["recolor_mode_toggler","navigator_screen","navigator_footer","navigator_footer_text","reset_gcm","reset_lcm","canvas_processed","shortcode_output","preset_selectbox","preset_mode_checkbox","preset_title_input","preset_upd_btn","preset_add_btn","save_png","save_png_wp","bg_shape_color","preview_color"],ui:{},presets:{},actual_preset:!1,shortcode:{},color_map:{},recolor_mode:"g",is_svg_info:!1,viewbox:!1,preview_color:"transparent",target_color_index:!1,target_shape_index:!1,preset_style_mode:!1,preset_saving_alert:!1,canvas_processed_ctx:!1,is_downloading:!1,cp_callbacks:[function(){n.update_ui(e.clean_id(t.els.target_input.id),t.get_ordinary_color_value(!0)),n.generate_shortcode()},function(e){if(n.els.navigator_screen){var t=e.rgba.join(","),i=n.els.preview_color;n.preview_color="rgba("+t+")",n.update_ui("preview_color",n.preview_color),n.generate_shortcode(),i&&(i.value=n.preview_color)}}],init:function(){if(this.subscribe(),this.init_design_options(),this.init_navigator(),this.init_shortcode_ui(),this.init_extra_options(),0!==this.actual_preset){var t=this.actual_preset;this.actual_preset=this.actual_preset.split("@"),this.presets[this.actual_preset[0]][this.actual_preset[1]]?this.trigger_preset(t):e.show_notice("Sorry but this preset is not defined.",1)}},subscribe:function(){e.on("sel_lib_item",function(t){var i,s=t||window.event,r=s.data&&s.data.item_id,o=s.data&&s.data.cln_id;o&&(a.state.actual_cln=o),r?(i=r.substr(-2),n.update_ui("id",r),n.generate_shortcode(),n.viewbox="-p"===i?[0,0,316,512]:"-l"===i?[0,0,512,316]:[0,0,512,512]):e.show_notice("Some problems with ID of selected Image",1)},!1),e.on("del_preset",function(e){var t=(e||window.event).data;t&&t.id&&t.el&&n.delete_preset(t.id,t.el)},!1)},init_design_options:function(){for(var i=e.gcl("ui"),a=0;a<i.length;a++){var r=e.attr(i[a],"data-param");if(void 0!==this.ui[r]){for(var o=i[a].parentNode.parentNode;"ui_row"!==e.attr(o,"data-role");)o=o.parentNode;this.ui[r].row_el=o,this.ui[r].el=i[a]}e.on("change",function(){n.update_ui(e.attr(this,"data-param"),this.value),n.generate_shortcode()},i[a])}s.num_ctrls_init(function(e,t){n.update_ui(e,t),n.generate_shortcode()}),t.init({target:"."+e.slug+"_mcp",callbacks:this.cp_callbacks,reset_calls:!0,show_initial_color:!1})},init_navigator:function(){this.els.navigator_screen&&e.on("click",function(i){var s=i||window.event,a=this.style.backgroundColor||"#fff";t.reset_target_preview(),t.config.mode="custom",t.config.target_callback=1,t.show_picker(a),e.cancel_bubble(s)},this.els.navigator_screen),e.on("mouseout",function(){n.svg_info&&(n.navigator_footer_set_state("init"),n.svg_info=!1)},this.els.navigator_screen),this.els.recolor_mode_toggler&&e.on("click",function(t){var i=t||window.event;"g"===n.recolor_mode?(n.recolor_mode="l",this.innerHTML="Local repainting"):(n.recolor_mode="g",this.innerHTML="Global repainting"),e.cancel_bubble(i)},this.els.recolor_mode_toggler),this.els.reset_gcm&&e.on("click",function(e){n.color_map.g&&(delete n.color_map.g,n.set_color_map(),n.generate_shortcode(),this.style.display="none")},this.els.reset_gcm),this.els.reset_lcm&&e.on("click",function(e){n.color_map.l&&(delete n.color_map.l,n.set_color_map(),n.generate_shortcode(),this.style.display="none")},this.els.reset_lcm)},navigator_handler:function(i,s){var a=i||window.event,n=a.target||a.srcElement,r=parseInt(e.attr(n,"data-index")),o=n.nodeName.toLowerCase(),l=e.attr(n,"fill"),_=n.parentNode,c=_.parentNode.nodeName.toLowerCase(),d=parseInt(e.attr(_,"data-index"));r>=0?s?this.render_navigator_footer_text({target_name:o,target_index:r,target_fill:l,parent_name:c,parent_index:d}):l&&(this.target_color_index=e.attr(n,"data-color"),this.target_shape_index=r,t.els.target_input&&"color_map_control"!==t.els.target_input.id&&t.reset_target_preview(),t.config.target_callback=0,t.state.color.rgba=!1,t.els.target_preview=void 0,t.els.prev_target_preview=void 0,t.els.target_input={id:"color_map_control",value:!1,attributes:{"data-init-value":{value:l}}},t.show_picker(l,!0),e.cancel_bubble(a)):-1===r?s||("custom"===t.config.mode&&(t.config.target_callback=0,t.config.mode="normal"),e.trigger("click",!1,this.els.bg_shape_color.nextElementSibling),e.cancel_bubble(a)):s||t.hide_picker()},toggle_navigator_footer_ui:function(){this.els.reset_gcm.style.display=void 0!==this.color_map.g?"block":"none",this.els.reset_lcm.style.display=void 0!==this.color_map.l?"block":"none",this.navigator_footer_set_state(this.color_map?"init":"ui")},render_navigator_footer_text:function(t,i){var s="";t?(s='Element: <b class="'+e.slug+'_b">'+t.target_name+'</b> with data-index="<b class="'+e.slug+'_b">'+t.target_index+'</b>"',t.target_fill&&(s+='<span style="background-color:'+t.target_fill+';" class="'+e.slug+'_micro_color_preview"></span>'),"g"===t.parent_name&&t.parent_index>=0&&(s+='<br>Parent element: <b class="'+e.slug+'_b">g</b> with data-index="<b class="'+e.slug+'_b">'+t.parent_index+'</b>"'),e.add_class(this.els.navigator_footer,"navigator_footer_state_data",!0),this.svg_info=!0):s=i,this.els.navigator_footer_text.innerHTML=s},navigator_footer_set_state:function(t){this.els.navigator_footer.className=e.slug+"_navigator_footer_state_"+t},recolor_navigator_screen:function(e){},init_shortcode_ui:function(){this.els.shortcode_output&&e.on("focus",function(){this.select()},this.els.shortcode_output),e.on("click",function(){e.clipboard(n.els.shortcode_output,0)},e.ge("copy_shortcode")),e.on("click",function(){var t,i=n.els.shortcode_output.value;(t=e.parse_shortcode_string(i)).preset?n.presets[t.preset]?(n.trigger_preset(t.preset),e.show_notice('Your shortcode contains the preset: "'+t.preset+'". It has been activated.',0)):e.show_notice("Your shortcode contains an undefined preset ID.",1):t&&n.do_preset(n.actual_preset,t)},e.ge("paste_shortcode"))},update_shortcode_output:function(t){var i=t?t.slice(0,-1):'id="'+this.ui.id+'"'+(void 0!==this.shortcode.dir?' dir="'+this.shortcode.dir+'"':"");this.els.shortcode_output.value="["+e.slug+" "+i+"]"},init_extra_options:function(){var t,i="Your image is empty. Please choose an image in the library.";this.els.preset_selectbox&&e.on("change",function(){n.do_preset(this.value,!1)},this.els.preset_selectbox),this.els.preset_mode_checkbox&&e.on("change",function(){n.preset_style_mode=this.checked},this.els.preset_mode_checkbox),this.els.preset_add_btn&&e.on("click",function(){n.save_preset(!1)},this.els.preset_add_btn),this.els.preset_upd_btn&&e.on("click",function(){n.update_preset()},this.els.preset_upd_btn),this.els.canvas_processed?this.canvas_processed_ctx=this.els.canvas_processed.getContext("2d"):console.log("Some problems with the HTML5 canvas supporting."),e.on("click",function(t){if(void 0!==n.shortcode.id){var s=n.get_svg_data();s&&e.quick_file_saver(s)}else e.show_notice(i,1);e.cancel_bubble(t)},e.ge("save_svg")),t=function(t,s){if(!1===n.is_downloading){var a=t.target||t.srcElement;if(void 0!==n.shortcode.id){var r=n.get_svg_data();r&&(n.is_downloading=!0,e.draw_svg_on_canvas(n.els.canvas_processed,n.canvas_processed_ctx,r,[!1,function(t){s?e.save_file_to_wp_media(n.shortcode.id,"png",t):e.save_canvas_data_as_png(a,n.shortcode.id,t),n.is_downloading=!1}],n.viewbox[2],n.viewbox[3]))}else e.show_notice(i,1);e.cancel_bubble(t)}},e.on("click",function(e){t(e,!1)},this.els.save_png),e.on("click",function(e){t(e,1)},this.els.save_png_wp),e.on("click",function(t){n.reset_ui(!0,!0,!0,!0),e.cancel_bubble(t)},e.ge("reset_all"))},do_preset:function(i,s){if(console.log("id",i,typeof i),console.log("preset_params",s),"0"===i)return this.actual_preset=!1,!1;if(!1===(i=i?Array.isArray(i)?i:i.split("@"):0))return e.show_notice("Sorry but this preset is corrupted.",1),!1;var n={},s=s||this.presets[i[0]][i[1]],r="";if(a.state.actual_cln=s.dir?s.dir:a.state.actual_cln||"default","default"!==a.state.actual_cln&&(n.dir=a.state.actual_cln,r+=' dir="'+a.state.actual_cln+'" '),s){if(!1===this.preset_style_mode&&s.id||this.ui.id){this.reset_ui();for(var o in s){var l=s[o];!0===this.preset_style_mode&&"id"===o&&this.ui.id&&(l=this.ui.id),this.update_ui(o,l,!0),n[o]=l,r+=o+'="'+l+'" '}this.toggle_navigator_footer_ui(),this.update_shortcode_output(r),this.shortcode=n||s,this.render_image(),t.render_previews(!0),this.actual_preset=i}}else void 0===s&&e.show_notice("Sorry but this preset is corrupted.",1)},save_preset:function(t){console.log("this.shortcode",this.shortcode);var i=t?t[1]:e.escape_sting(this.els.preset_title_input.value),s=t?t[0]:"MY",a=s+"@"+i;if(i&&this.shortcode){var r=e.clone_obj(this.shortcode);!0===this.preset_style_mode&&i&&(delete r.id,void 0!==r.dir&&delete r.dir),this.preview_color&&(r.preview_color=this.preview_color),this.preset_saving_alert&&e.remove_class(this.els.preset_title_input,"alert_mess"),this.actual_preset=[s,i],this.preset_sending_wrapper(s,i,r,t?"upd":"add",function(t,r){if(n.preset_saving_alert=!1,e.show_notice("OK! Your preset has been "+("add"===r?"added":"updated"),0),n.presets[s][i]=n.shortcode,"add"===r){var o=e.ce("option",{value:a},i);n.els.preset_selectbox.children[1].appendChild(o),n.els.preset_title_input.value="",n.trigger_preset(a)}},function(t){e.show_notice(t,1)})}else e.add_class(this.els.preset_title_input,"alert_mess"),this.preset_saving_alert=!0},trigger_preset:function(t){this.els.preset_selectbox.value=t,e.trigger("change",!1,this.els.preset_selectbox)},update_preset:function(){!1!==this.actual_preset&&0!==this.actual_preset&&this.save_preset(this.actual_preset)},delete_preset:function(t,i){t&&i?(t=t.split("@"),i.style.backgroundColor="tomato",this.preset_sending_wrapper(t[0],t[1],null,"del",function(e){i.parentNode.removeChild(i)},function(t){e.show_notice(t,1)})):e.show_notice("Unable to remove this preset. Reason: some data is empty.",1)},preset_sending_wrapper:function(t,i,s,a,n,r){var o={action:"presets_handling",preset_group:t,preset_title:i,preset_data:s,preset_act:a},l=function(t){e.send(e.plugin_url,t,function(e){1!==parseInt(e)?r(e):n(e,a)})};"del"!==a?e.draw_svg_on_canvas(this.els.canvas_processed,this.canvas_processed_ctx,this.get_svg_data(),[1,l,o],this.viewbox[2],this.viewbox[3]):l(o)},update_ui:function(e,t,a){if("id"!==e&&"color_map_control"!==e&&void 0!==this.ui[e]){var n=this.ui[e].type;if(this.ui[e].user_value=t,void 0!==this.ui[e].dependency){var r=this.ui[e].dependency;if(r){var o=r[t];for(key in r)if(key!==t)for(i in r[key])this.ui[r[key][i]].row_el.style.display="none";for(key in o)this.ui[o[key]].row_el.style.display="block"}}a&&("num_control"===n?s.update_num_ctrl(e,t):"transform_control"===n?s.update_transform_ctrl(-1,t):"preview"===n?this.unpack_color_map():this.ui[e].el.value=t)}else"id"===e?t&&(this.ui.id=t,a&&this.hightlight_image(t)):"color_map_control"===e?this.update_color_map(t):"preview_color"===e?this.preview_color=t:console.log("Undefined parameter: "+e)},reset_ui:function(i,a,n,r){if(this.shortcode.id){this.shortcode=void 0!==this.shortcode.dir?{dir:this.shortcode.dir}:{},void 0!==this.ui.id&&(this.shortcode.id=this.ui.id);for(var o in this.ui)if("id"!==o&&this.ui[o].el){var l=this.define_def_ui_value(o);this.update_ui(o,l,!0)}s.transform_center=!0,e.add_class(s.transform_locked_els,"numctrl_locked_content",!0),this.color_map=!1,a&&this.update_shortcode_output(),r&&t.render_previews(!0),n&&(this.els.preset_selectbox.value=0,this.actual_preset=!1),i&&this.render_image()}},generate_shortcode:function(t,i,s){var n="",r={},o=a.state.actual_cln;if(void 0!==this.ui.id){r.id=this.ui.id,n='id="'+this.ui.id+'" ',o&&"default"!==o&&(r.dir=o,n+=' dir="'+o+'" ');for(var t in this.ui){if(void 0!==this.ui[t].parent){var l,_=this.ui[this.ui[t].parent],c=!!_.user_value&&_.user_value;if(void 0===_.dependency[c])continue;for(;void 0!==_.parent;)_=this.ui[_.parent];if(c=!!_.user_value&&_.user_value,l=Array.isArray(_.value)?_.value[0]:_.value,c===l){this.ui[t].row_el.style.display="none";continue}}if(this.ui[t].user_value){e.var_to_str(this.ui[t].user_value)!==e.var_to_str(this.define_def_ui_value(t))&&!1!==this.ui[t].user_value&&(r[t]=this.ui[t].user_value,n+=t+'="'+this.ui[t].user_value+'" ')}}this.update_shortcode_output(n),this.shortcode=r,this.render_image()}},define_def_ui_value:function(e){return void 0!==this.ui[e].def_value?this.ui[e].def_value:Array.isArray(this.ui[e].value)?this.ui[e].value[0]:this.ui[e].value},render_image:function(){this.shortcode.id&&e.send(e.plugin_url,{action:"do_shortcode",shortcode:this.shortcode},function(t){if(n.els.navigator_screen.innerHTML=t,-1===t.indexOf("EMPTY IMAGE")){var i=e.gt("defs",0,n.els.navigator_screen).children,s=i.length;if(s>0)for(var a=0;a<s;a++){var r=i[a];e.on("mouseover",function(e){n.navigator_handler(e,!0)},r),e.on("click",function(t){n.navigator_handler(t,!1),e.cancel_bubble(t)},r)}}else e.show_notice("Sorry but this image is corrupted.",1)})},get_svg_data:function(){return this.els.navigator_screen.children[0].innerHTML},hightlight_image:function(t){var i=e.ge(t);i?i.checked=!0:console.log("Image with name: "+t+" undefined.")},update_color_map:function(e){if(e){var t=this.recolor_mode,i=!0,s="g"===t?this.target_color_index:this.target_shape_index,a=0;!1===this.color_map&&(this.color_map={}),this.color_map[t]||(this.color_map[t]=[],this.els["reset_"+t+"cm"].style.display="block",this.els.navigator_footer_text.style.display="none"),part=this.color_map[t],part.forEach(function(e,t,n){e[0]+""==s+""&&(i=!1,a=t)}),i?this.color_map[t].push([s,e]):this.color_map[t][a]=[s,e],this.set_color_map()}},unpack_color_map:function(){if(t=this.ui.color_map.user_value){var e=t.split("@"),t={};for(i=0;i<e.length;i++){var s=e[i][0],a=e[i].slice(1).split("|");for(t[s]||(t[s]=[]),j=0;j<a.length;j++){var n=a[j].split(":"),r=n[1];if(n[0].indexOf(";")>-1){var o=n[0].split(";");for(l in o)l=parseInt(l),t[s].push([l,r])}else{var l=parseInt(n[0]);t[s].push([l,r])}}}this.color_map=t}},set_color_map:function(){var t="",i=this.color_map,s=0;for(part in i){var a=e.collapse_2Darray_to_clean_object(i[part]);t+=(s>0?"@":"")+("g"===part?"g":"l");for(rule in a)t+=rule+":"+a[rule]+"|";t=t.slice(0,-1),s++}this.ui.color_map.el.value=t,this.ui.color_map.user_value=t}};return n}(ICONSFACTORY,window.MCP,ICONSFACTORY.CUSTOM_UI,ICONSFACTORY.LIBRARY),ICONSFACTORY.WORKROOM=function(e,t){return{args:arguments,init:function(){t.init_smart_layout("workroom_layer_2",["","wr_landscape"]),t.init_scroller(680),t.init_fixed_layout(680)}}}(ICONSFACTORY,ICONSFACTORY.UNIVERSAL_PAGE_CTRLS),ICONSFACTORY.STOREROOM=function(e){var t={args:arguments,els:["preset_grid"],vc:!1,vc_target_field:!1,vc_actual_shortcode:!1,vc_mode:"dynamic",preset_cards:[],def_bg_color:"#eceff1",card_bg_state:!1,init:function(){this.set_local_listeners(),this.cache_preset_cards(),this.vc&&(this.els.selected_preset=e.ge("selected_preset"),e.plugin_url||(e.plugin_url=e.attr(this.els.preset_grid,"data-url")))},cache_preset_cards:function(){var t,i=e.gcl("preset");if(i)for(t=0;t<i.length;t++){var s=i[t],a=s.style.backgroundColor;this.preset_cards.push([s,a])}},set_local_listeners:function(){this.els.preset_grid&&(e.on("click",function(e){t.preset_grid_handler(e)},this.els.preset_grid),this.vc||e.on("click",function(e){t.hide_active_cards()},!1))},hide_active_cards:function(){for(var t=e.gcl("active");t.length>0;)e.remove_class(t[0],"active")},preset_grid_handler:function(t){var i,s=t||window.event,a=s.target||s.srcElement,n=a,r=e.attr(a,"data-act"),o=s.shiftKey;if(a&&"nothing"!==r){if(!1===this.vc&&"edit"!==r&&"dwnld"!==r&&e.cancel_bubble(t),r&&"bg_toggler"!==r)for(;"label"!==n.tagName.toLowerCase();)n=n.parentNode;if(i=e.attr(n,"data-id"),"del"===r)this.delete_preset(i,n,!o);else if("vc_copy_bg"===r)e.clipboard(a.nextSibling,0);else if("bg_toggler"===r)this.toggle_cards_bg(a);else if(!1===this.vc&&"focus"===r)e.add_class(n,"active");else if("toggle_format"===r){var l=a.nextSibling,_=e.gcl("dwnld_btn",n)[0];this.toggle_format(a,l,_)}else this.vc&&(this.vc_target_field.value=i,e.attr(this.els.selected_preset,"href",e.plugin_url+"&preset="+i),this.vc_mode="static")}!1===this.vc&&"focus"!==r&&this.hide_active_cards()},toggle_cards_bg:function(t){this.card_bg_state?(t.innerHTML="Hide recommended backgrounds",this.card_bg_state=!1):(t.innerHTML="Show recommended backgrounds",this.card_bg_state=!0),e.toggle_class(this.els.preset_grid,"def_bg_colors",this.card_bg_state)},find_selected_preset:function(){var t=document.querySelector('input[name="'+e.slug+'_radio"]:checked');t&&(t.checked=!1)},toggle_format:function(t,i,s){var a=t.innerHTML,n="SVG"===a,r=i.value,o=!!s&&e.attr(s,"href"),l=function(e){return e.replace("."+a.toLowerCase(),n?".png":".svg")};t.innerHTML=n?"PNG":"SVG",i&&(e.highlight_changes(i),i.value=l(r)),o&&(e.highlight_changes(s),e.attr(s,"href",l(o)))},delete_preset:function(t,i,s){if(s&&!confirm("Do you really want to do this?"))return!1;e.trigger("del_preset",{id:t,el:i})},init_vc_ui:function(){this.vc=!0,this.els.preset_grid=e.ge("preset_grid"),this.init(),this.vc_target_field=e.ge("target_field_vc"),this.vc_target_field&&this.vc_actual_shortcode&&"dynamic"===this.vc_mode&&(this.vc_target_field.value=this.vc_actual_shortcode)},set_actual_shortcode_data_from_vc:function(t){var i="";for(key in t)i+=" "+key+'="'+t[key]+'"';this.vc_actual_shortcode="["+e.slug+" "+i+"]",this.vc_mode=t.preset?"static":"dynamic"},set_new_model_to_vc:function(t){var i,s=this.vc_target_field.value;if(s)if(-1!==s.indexOf("[")){if(this.vc_mode="dynamic",i=e.parse_shortcode_string(s)){for(key in t.attributes.params)"image_box_size"!==key&&"image_box_align"!==key&&"css"!==key&&"css_class"!==key||(i[key]=t.attributes.params[key]);t.attributes.params=i,t.changed.params=i}}else this.vc_mode="static"}};return t}(ICONSFACTORY),ICONSFACTORY.UPLOADROOM=function(e){return{init:function(){this.init_upload_area()},init_upload_area:function(){var t=e.gcl("auto_submit");if(t)for(var i=0;i<t.length;i++){var s=t[i];e.attr(s,"data-disabled")?e.on("click",function(t){var i=e.ge("title");e.show_notice("You have no registered image collections. Please create a new record in the collection manager.",1),i&&i.focus(),e.cancel_bubble(t)},s):e.on("change",function(){var t=e.attr(this,"data-type_filter");e.check_allowed_file_type(this.files,t)?this.parentNode.submit():e.show_notice("Sorry but allowed file type is: <strong>"+t+"</strong>.",1)},s)}}}}(ICONSFACTORY),ICONSFACTORY.SUPPORTROOM=function(e){var t={els:["support_form","notes","subject","sender","message","submit"],state:{prev_subject:0},subjects:!1,init:function(){console.log(this.subjects),e.on("click",function(i){e.cancel_bubble(i),t.submit_form()},this.els.submit),e.on("change",function(){t.toggle_subject(this.value)},this.els.subject),e.on("focus",function(){e.remove_class(t.els.sender,"alert_mess")},this.els.sender),e.on("focus",function(){e.remove_class(t.els.message,"alert_mess")},this.els.message)},toggle_subject:function(e){var t=this.subjects.indexOf(e);this.els.notes.children[this.state.prev_subject].style.display="none",this.els.notes.children[t].style.display="inline-block",this.state.prev_subject=t},submit_form:function(){this.check_form()&&this.els.support_form.submit()},check_form:function(){var t=!1;return this.els.sender&&this.els.message?(e.check_email(this.els.sender.value)||(e.add_class(this.els.sender,"alert_mess"),t=!0),this.els.message.value||(e.add_class(this.els.message,"alert_mess"),t=!0)):t=!0,!t},download_backup:function(){e.send(e.plugin_url,{action:"download_backup"},function(e){})}};return t}(ICONSFACTORY);